var t,s;$(document).ready(function(){showSmallBag(true);showMei()});function showSmallBag(a){clearTimeout(s);t=setTimeout(function(){showSmallBagDelay(a)},500)}function showSmallBagDelay(b){var a=$("#pop_up_shopping");var d=$("#countBank");var c=$("#contextPath").val();$.ajax({type:"POST",url:c+"/cart/small",data:{showCountAndAmount:b},success:function(h){var g=h.count;d.html(g);if(!b){var f=getBagHtml(h);$("#pop_up_shopping").html(f);a.stop().slideDown()}else{$("#shopping_quantity").text(h.count);$("#shopping_amount").text("¥"+h.amount)}var e=$(".my_product").size();if(e>3){loadScrollSmallBag("my_product_container")}s=setTimeout(function(){a.stop().slideUp()},3000)}})}function alwaysShow(){clearTimeout(s);$("#pop_up_shopping").show()}function hideSmallBag(){clearTimeout(t);clearTimeout(s);s=setTimeout(function(){$("#pop_up_shopping").stop().slideUp()},500)}function closeSmallBag(a){$("#"+a).stop().slideUp(100)}function addProduct(e,a,b,g,f,d){var j=1;var i=80;var c="";var h=function(o,n,r,k,q){var l=$.Deferred();var m=$("#contextPath").val();var p=addCart(m,o,n,r,k,0,d);switch(p.result){case -1:j=-1;c="商品库存不足！";break;case -2:j=-2;c="您一次最多只能添加"+p.maxShopping+"件商品！";break;case -3:j=-3;c="您一次最少必须添加"+p.minShopping+"件商品！";break;case -4:j=-4;c="商品已售罄！";break;case -5:j=-5;c="商品信息有误！";break;case -8:j=-8;c="非常抱歉,活动无效！";break;case -9:j=-9;c="非常抱歉,商品和活动不匹配！";break;case -10:j=-10;c="非常抱歉,该商品已存在购物袋中！";break;case -15:j=-15;i=p.maxvalue;c="抱歉，购物袋最多只能添加"+p.maxvalue+"个商品";break;case -16:j=-16;c="本商品所在活动为VIP专场活动，升级为VIP之后才可以参与购买哦~会员升级规则请至魅力惠APP首页下方“我的” ——“会员规则”查看";if(p.msg!=""){c=p.msg}break;case -17:j=-17;if(p.msg!=""){c=p.msg}break;case -18:j=-1;c="商品已进入购物袋，请在购物袋中查看！";break;default:showSmallBag();break}l.resolve();return l.promise()};h(e,a,b,g,f);return{result:j,msg:c,maxvalue:i}}function delSamllBagProduct(b){var a=$("#contextPath").val();$.ajax({type:"POST",url:a+"/cart/delete",data:{bagDetailId:b},success:function(c){showSmallBag()}})}function getBagHtml(b){var a=b.html;if(b.count!=0){$("#shopping_quantity").text(b.count);$("#shopping_amount").text("¥"+b.amount)}return a}function getBankCount(c){var b=0;for(var a=0;a<c.productList.length;a++){b=b+c.productList[a].shoppingCount}return b}function loadScrollSmallBag(a){$("."+a).jscroll({W:"3.5px",BgUrl:"",Bg:"right #e7e7e7 repeat-x",Bar:{Pos:"up",Bd:{Out:"#000 background-color #000",Hover:"#000 "},Bg:{Out:"-45px 0 repeat-x #000",Hover:"-58px 0 repeat-x  #000 pointer",Focus:"-71px 0 repeat-x  #000"}},Btn:{btn:false,uBg:{Out:"0 0 ",Hover:"-15px 0",Focus:"-30px 0"},dBg:{Out:"0 -15px",Hover:"-15px -15px",Focus:"-30px -15px"}},Fn:function(){}})}$(window).scroll(function(){var a=$(window).scrollTop();if(a>=160){$("#navBarId").removeClass();$("#navBarId").addClass("nav_container nav_container_top")}else{$("#navBarId").removeClass();$("#navBarId").addClass("nav_container")}});var resultLiIndex=-1;function initSearchBar(){var a="https://www.mei.com//appapi/search/searchDefault/v3";$.ajax({url:a,success:function(b){$("#searchTxt").attr("placeholder",b.words)}})}function submitSearchKeyword(){var d="/home/search.html";var b=encodeURIComponent($("#searchTxt").val())||$("#searchTxt").attr("placeholder");var c={q:b};var e=encodeUrl(c);var a=d+"?"+e;window.open(a)}function highLightLiItem(){$(".result li").removeClass("active");$(".result li:eq("+resultLiIndex+")").addClass("active")}function searchItem(b){var d="/home/search.html";var c={q:encodeURIComponent(b.name),brandNameEn:b.brandNameEn,brandNameZh:b.brandNameZh,firstCategoryId:b.category1Id,secondCategoryId:b.category2Id,thirdCategoryId:b.category3Id,type:b.type};var e=encodeUrl(c);var a=d+"?"+e;window.open(a)}function resetSearchItem(){if($(".result li").length){resultLiIndex=-1;$(".result li").removeClass("active")}}$(document).bind("keyup",function(d){if(d.keyCode===38){if(resultLiIndex>0){resultLiIndex--}else{resultLiIndex=$(".result li").length-1}highLightLiItem(resultLiIndex)}else{if(d.keyCode===40){if(resultLiIndex<$(".result li").length-1){resultLiIndex++}else{resultLiIndex=0}highLightLiItem(resultLiIndex)}else{if(d.keyCode===13&&$(":focus").length){if($(":focus").attr("id")==="searchTxt"){if(resultLiIndex===-1){submitSearchKeyword()}else{var b=$(".result li:eq("+resultLiIndex+")");var a=b.find("span:eq(0)").text();var c=b.data("item");searchItem(c)}}}}}});$(document).bind("click",function(a){if($(a.target).attr("id")&&$(a.target).attr("id")==="searchTxt"){resetSearchItem();if($("#search_bar .result").css("display")==="none"&&$("#search_bar .result li").length>0){$("#search_bar .result").show()}}else{$("#search_bar .result").hide();resetSearchItem()}});$("#searchBtn").live("click",function(){submitSearchKeyword()});$(".result li").live("mouseover",function(){$(this).addClass("active")}).live("mouseout",function(){$(this).removeClass("active")}).live("click",function(){var a=$(this).find("span:eq(0)").text();var b=$(this).data("item");searchItem(b)});$("#searchTxt").live("input on",function(){if($("#search_bar .result").css("display")==="none"){$("#search_bar .result").show()}var a=$(this).val();var b="https://www.mei.com/appapi/search/searchSuggest/v3?text="+a;$.ajax({url:b,success:function(c){var d="";c.result.forEach(function(f,e){var g=['<li class="clearfix">','<span class="">'+f.name+"</span>","<span>约"+f.productCount+"件商品</span>","</li>"].join("");d+=g});$(".result").html(d);$(".result li").each(function(e,f){$(f).data("item",c.result[e])})}})});function addPolyFill(){if(!Object.keys){Object.keys=(function(){var c=Object.prototype.hasOwnProperty,d=!({toString:null}).propertyIsEnumerable("toString"),b=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],a=b.length;return function(g){if(typeof g!=="object"&&typeof g!=="function"||g===null){throw new TypeError("Object.keys called on non-object")}var e=[];for(var h in g){if(c.call(g,h)){e.push(h)}}if(d){for(var f=0;f<a;f++){if(c.call(g,b[f])){e.push(b[f])}}}return e}})()}if(!Object.entries){Object.entries=function(c){var d=Object.keys(c),b=d.length,a=new Array(b);while(b--){a[b]=[d[b],c[d[b]]]}return a}}}function encodeUrl(b){var c="";for(var a in b){c+=a+"="+b[a]+"&"}return c.substring(0,c.length-1)}function GetQueryString(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)","i");var c=window.location.search.substr(1).match(b);if(c!=null){return decodeURI(c[2])}return null}$(document).ready(function(){addPolyFill();var a=GetQueryString("q");if(a){$("#searchTxt").val(a)}else{initSearchBar()}});function toLogin(){goldlogRecord("/mei.3.1","","","H1703600");var b=$("#contextPath").val();var c=document.location.href;c=base64encode(c);var a=b.split("//");if(typeof a[1]==="undefined"){host=""}else{host="http://"+a[1]}location.href=host+"/user/tologinpage?callbackUrl="+c}function toRegist(){goldlogRecord("/mei.3.1","","","H1703600");var b=$("#contextPath").val();var c=document.location.href;c=base64encode(c);var a=b.split("//");if(typeof a[1]==="undefined"){host=""}else{host="http://"+a[1]}location.href=host+"/user/toregistpage?callbackUrl="+c}function showMei(){$("#pup_mei").live("mouseover",function(){$(this).find(".pop_up_myGlamour").show()});$("#pup_mei").live("mouseout",function(){$(this).find(".pop_up_myGlamour").hide()});$("#pup_mei li:eq(0)").live("click",function(){window.location.href=$("#contextPath").val()+"/myMeiOrders/myOrderList"});$("#pup_mei li:eq(1)").live("click",function(){window.location.href=$("#contextPath").val()+"/myComment/myNotComment"});$("#pup_mei li:eq(2)").live("click",function(){window.location.href=$("#contextPath").val()+"/myConponsMessage/intomyconpons"});$("#pup_mei li:eq(3)").live("click",function(){window.location.href=$("#contextPath").val()+"/personInfo/showPersonInfo"});$("#pup_mei li:eq(4)").live("click",function(){window.location.href=$("#contextPath").val()+"/userAddress/userAddressshow"});$("#pup_mei li:eq(5)").live("click",function(){window.location.href=$("#contextPath").val()+"/personInfo/showPersonInfo"})}function clicksina(){var a=$("#contextPath").val();$.ajax({type:"POST",url:a+"/checkout/getShareWebsiteRecord",data:{websiteType:"1"},success:function(c){var b=c.result}})}function shoppingSkipBag(){var a=$("#contextPath").val();var b=isLogins();if(b!=null&&b!="nologin"){location.href=a+"/cart"}else{var a=$("#contextPath").val();var c=document.location.href;c=base64encode(c);location.href=a+"/user/tologinpage?callbackUrl="+c}}function illegalChar(b){var a=/^([\u4E00-\u9FA5a-zA-Z0-9._-])*$/;if(a.test(b)){return false}else{return true}}function goldlogRecord(a,d,c,b){if(typeof(goldlog)=="object"){goldlog.record(a,d,c,b)}};